package com.malware98.brokenpath.client;

import com.malware98.brokenpath.data.ModConfigs;
import net.minecraft.client.Minecraft;
import net.minecraft.client.player.LocalPlayer;

public class PlayerXPClient {

    // Almacenamiento temporal para la XP y el nivel del cliente
    private static int clientExperience = 0;
    private static int clientLevel = 1;

    // Actualiza los valores de XP y nivel en el lado del cliente.
    public static void setPlayerXP(int experience, int level) {
        clientExperience = experience;
        clientLevel = level;
        updateClientVanillaXP();
    }

    // Procedimiento para obtener la XP actual en el cliente (para posibles usos en la UI)
    public static int getClientExperience() {
        return clientExperience;
    }

    // Procedimiento para obtener el nivel actual en el cliente (para posibles usos en la UI)
    public static int getClientLevel() {
        return clientLevel;
    }

    // Este es el procedimiento clave para integrar con la barra de XP de Minecraft
    private static void updateClientVanillaXP() {
        LocalPlayer player = Minecraft.getInstance().player;
        if (player == null) {
            return;
        }

        // Si el jugador está en el nivel máximo del mod, lo reflejamos en la XP de Minecraft.
        if (clientLevel >= ModConfigs.MAX_LEVEL) {
            player.experienceLevel = ModConfigs.MAX_LEVEL;
            player.experienceProgress = 1.0F;
            player.totalExperience = 0;
            return;
        }

        // Calcula la XP total que el jugador de nuestro mod ha acumulado para su nivel actual, desde el inicio de ese nivel.
        float xpNeededForCurrentLevelProgress = ModConfigs.getInstance().getXPForNextLevel(clientLevel);

        // Calcula el progreso dentro del nivel actual (0.0 a 1.0)
        float progress = (float) clientExperience / xpNeededForCurrentLevelProgress;
        progress = Math.min(1.0F, Math.max(0.0F, progress));

        // Actualiza las variables de XP del jugador vanilla de Minecraft
        // Estas variables son las que Minecraft usa para dibujar la barra de XP y el número de nivel.
        player.experienceLevel = clientLevel;
        player.experienceProgress = progress;
    }
}