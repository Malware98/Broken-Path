package com.malware98.brokenpath.network.messages;

import com.malware98.brokenpath.client.PlayerXPClient;
import net.minecraft.network.FriendlyByteBuf;
import net.minecraftforge.network.NetworkEvent;

import java.util.function.Supplier;

/**
 * Packet sent from the server to the client to synchronize player experience (XP),
 * level, and XP debt.
 */
public class SyncPlayerXPPacket {

    // --- Packet Fields ---
    private final int experience;
    private final int level;
    private final int xpDebt;
    private final int xpNeededForNextLevel;

    // --- Constructors ---
    /**
     * Creates the packet with current player XP data from the server.
     */
    public SyncPlayerXPPacket(int experience, int level, int xpDebt, int xpNeededForNextLevel) {
        this.experience = experience;
        this.level = level;
        this.xpDebt = xpDebt;
        this.xpNeededForNextLevel = xpNeededForNextLevel;
    }

    /**
     * Decodes packet data from the network on the client side.
     */
    public SyncPlayerXPPacket(FriendlyByteBuf buf) {
        this.experience = buf.readInt();
        this.level = buf.readInt();
        this.xpDebt = buf.readInt();
        this.xpNeededForNextLevel = buf.readInt();
    }

    // --- Encoding ---
    /**
     * Encodes packet data for network transmission from the server side.
     */
    public void toBytes(FriendlyByteBuf buf) {
        buf.writeInt(this.experience);
        buf.writeInt(this.level);
        buf.writeInt(this.xpDebt);
        buf.writeInt(this.xpNeededForNextLevel);
    }

    // --- Packet Handling ---
    /**
     * Handles the packet once received and decoded on the client.
     */
    public void handle(Supplier<NetworkEvent.Context> ctx) {
        ctx.get().enqueueWork(() -> {
            PlayerXPClient.setPlayerXP(this.experience, this.level, this.xpDebt, this.xpNeededForNextLevel);
        });
        ctx.get().setPacketHandled(true);
    }

    // --- Getters ---
    public int getExperience() { return experience; }
    public int getLevel() { return level; }
    public int getXpDebt() { return xpDebt; }
    public int getXpNeededForNextLevel() { return xpNeededForNextLevel; }
}